<!DOCTYPE html>
<html>
<head>
    <title>Admin – Behívás</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .option, .number {
            display: inline-block;
            padding: 10px 15px;
            margin: 5px;
            background-color: #eee;
            border: 2px solid #ccc;
            border-radius: 8px;
            cursor: pointer;
        }
        .option.selected {
            background-color: #cce5ff;
            border-color: #3399ff;
        }
        .number:hover {
            background-color: #d4edda;
        }
    </style>
</head>
<body>
    <h1>Admin felület – Behívás</h1>

    <h3>Válassz szakrendelést:</h3>
    <div id="options">
        {% for option in data %}
            <div class="option" onclick="selectOption('{{ option }}')">{{ option }}</div>
        {% endfor %}
    </div>

    <div id="number-list" style="margin-top: 20px;"></div>

    <script>
        let selectedOption = null;
        const data = {{ data|tojson }};
        const called = {{ called|tojson }};

        function selectOption(option) {
            selectedOption = option;
            document.querySelectorAll('.option').forEach(el => el.classList.remove('selected'));
            document.querySelectorAll('.option').forEach(el => {
                if (el.textContent === option) el.classList.add('selected');
            });

            // Frissítjük a hozzá tartozó sorszámokat
            const numberList = document.getElementById('number-list');
            numberList.innerHTML = `<h3>${option} sorszámai:</h3>`;

            if (data[option].length === 0) {
                numberList.innerHTML += '<p>Nincs rögzített sorszám.</p>';
                return;
            }

            data[option].forEach(number => {
                if (!called.includes(number)) {
                    const btn = document.createElement('div');
                    btn.className = 'number';
                    btn.textContent = number;
                    btn.onclick = () => callNumber(option, number);
                    numberList.appendChild(btn);
                }
            });
        }

        function callNumber(option, number) {
            fetch(`/call?option=${option}&number=${number}`)
                .then(() => {
                    alert(`Sorszám ${number} behívva a(z) ${option} rendelésre.`);
                    location.reload();
                });
        }
    </script>
</body>
</html>
